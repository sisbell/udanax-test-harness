# Finding 0017 Analysis

## Entries

### SS-VSPAN-VS-VSPANSET

**What happens**: The system provides two distinct retrieval operations for querying a document's virtual extent. `RETRIEVEDOCVSPAN` (opcode 14) returns a single span — a bounding range that covers the entire document's V-space. `RETRIEVEDOCVSPANSET` (opcode 1) returns a set of spans, one per occupied subspace region. For text-only documents, the two operations return equivalent results (a single span covering `1.x`). For documents with mixed content (text + links), the results diverge: `retrieve_vspan` returns a single span that attempts to bridge both subspaces (e.g., `1.1 for 1.2`), while `retrieve_vspanset` returns separate spans for each subspace (e.g., `{0.1 for 0.1, 1.1 for 0.11}`).

**Why it matters for spec**: These two operations have different return types with different information content. The single-span result from `retrieve_vspan` is lossy — it represents a bounding box over a potentially discontiguous address space, hiding the gap between the `0.x` and `1.x` subspaces. The spanset result preserves the subspace partition. Any specification of document extent querying must model both operations and note that the single-span result is an approximation that discards structural information. Operations that need accurate content enumeration (iteration, size calculation, content retrieval) require the spanset form.

**Code references**:
- Golden tests: `golden/documents/retrieve_vspan*.json`

**Concrete example**:
```
Document with "Hello World" (text only):
  retrieve_vspan:    1.1 for 0.11
  retrieve_vspanset: [{start: 1.1, width: 0.11}]
  → Equivalent: single text span

Document with "Click here" + one link:
  retrieve_vspan:    1.1 for 1.2   (bounding span across both subspaces)
  retrieve_vspanset: [{start: 0, width: 0.1}, {start: 1, width: 1}]
  → Different: spanset reveals 0.x (link) and 1.x (text) separately
```

**Provenance**: Finding 0017

### EC-VSPAN-MISLEADING-SIZE

**What happens**: For a document containing both text and links, `retrieve_vspan` returns a single span that bridges the link subspace (`0.x`) and text subspace (`1.x`). The example shows a span `1.1 for 1.2`, which implies continuous content from position `1.1` to position `2.3`. In reality, there is a gap — positions between `0.x` and `1.x` are in different subspaces and do not represent contiguous content. Using this span for size calculation or content iteration will yield incorrect results: the span's width overstates the actual content extent.

**Why it matters for spec**: The bounding span returned by `retrieve_vspan` does not satisfy a contiguity invariant — the V-addresses within the span are not necessarily occupied. The formal spec should distinguish between a *bounding span* (smallest span containing all content) and a *content span* (span where every V-position maps to an I-address). The `retrieve_vspan` result is the former, while individual spans in a `retrieve_vspanset` result are the latter.

**Code references**:
- Golden tests: `golden/documents/retrieve_vspan*.json`

**Concrete example**:
```
retrieve_vspan returns: 1.1 for 1.2
  Naive size interpretation: 1.2 units of content
  Actual content: 0.1 units in link subspace + ~1.0 units in text subspace
  Gap: V-positions between 0.x and 1.x are unoccupied
```

**Provenance**: Finding 0017

### PRE-CONTENT-ITERATION

**What happens**: To correctly iterate over all content in a document, callers must use `retrieve_vspanset` and process each span individually. Using the single bounding span from `retrieve_vspan` as a retrieval range will attempt to dereference V-positions in the gap between subspaces (producing empty or undefined results) and will mix link references (`0.x`) with text content (`1.x`) without distinguishing them. The finding prescribes per-span iteration as the correct access pattern.

**Why it matters for spec**: This establishes a usage precondition for document content access: correct iteration requires the spanset form, not the single-span form. Combined with the subspace convention (INV-SUBSPACE-CONVENTION), this means a caller must (1) retrieve the vspanset, (2) identify spans by subspace (`V < 1.0` → links, `V >= 1.0` → text), and (3) use appropriate retrieval operations per subspace. The spec for any "retrieve all content" operation should reference this two-step pattern.

**Code references**:
- Golden tests: `golden/documents/retrieve_vspan*.json`

**Provenance**: Finding 0017, also relates to Finding 0009 (SS-DUAL-ENFILADE) and Finding 0010 (EC-RETRIEVE-VSPANSET-BOTH-SUBSPACES)
