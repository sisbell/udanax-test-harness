# Finding 0033 Analysis

## Entries

### SS-ADDRESS-SPACE
**What happens:** Sequential single-character inserts receive contiguous I-addresses in the permascroll. The I-address allocation mechanism finds the previous highest I-address and increments by 1, so inserts performed in sequence always occupy an adjacent range. For example, 10 separate character inserts produce I-addresses `2.1.0.1.0.1.3.1` through `2.1.0.1.0.1.3.10`, forming a single contiguous range of width `0.10`.

**Why it matters for spec:** Defines the I-address allocation policy as a monotonically incrementing counter within a document's I-space. This is a structural property of how the permascroll grows: new content always appends at the next available I-address. This means I-space ordering reflects insertion chronology.

**Code references:** `findisatoinsertmolecule` in `backend/green/granf2.c` — the `TEXTATOM` branch calls `tumblerincrement(&lowerbound, 0, 1, isaptr)` to compute the next I-address by incrementing the previous highest by 1.

**Concrete example:**
- Before: I-space has highest address `2.1.0.1.0.1.3.0`
- Insert "A": allocates `2.1.0.1.0.1.3.1`
- Insert "B": allocates `2.1.0.1.0.1.3.2`
- Insert "C": allocates `2.1.0.1.0.1.3.3`
- Result: range `2.1.0.1.0.1.3.1` to `2.1.0.1.0.1.3.3`, width `0.3`

**Provenance:** Finding 0033

### INV-MONOTONIC
**What happens:** I-address allocation is strictly monotonically increasing within a document. Each new text insert receives an I-address exactly 1 greater than the previous allocation, regardless of where the content is inserted in V-space. This is an invariant of the insert operation.

**Why it matters for spec:** Formalizable as: for any two inserts where insert_A happens before insert_B chronologically, `i_address(insert_B) > i_address(insert_A)`. This is a global invariant on the I-space — it can never decrease or have gaps under normal sequential insertion.

**Code references:** `findisatoinsertmolecule` in `backend/green/granf2.c` — `tumblerincrement(&lowerbound, 0, 1, isaptr)`.

**Provenance:** Finding 0033

### ST-INSERT
**What happens:** When multiple single-character inserts are performed sequentially, the resulting I-addresses are contiguous. This means that bulk insertion of "ABCDEFGHIJ" and 10 sequential single-character inserts of "A", "B", ..., "J" produce identical I-space structure: both yield a single I-span of width 10. The `vspanset2ispanset` mapping returns 1 I-span, not N.

**Why it matters for spec:** The postcondition for insert can state that the new content occupies `[prev_max_iaddr + 1, prev_max_iaddr + len]` in I-space, where `len` is the number of characters inserted. For a sequence of single-character inserts, the composite postcondition is equivalent to a single bulk insert postcondition. This equivalence is a key property for reasoning about insert decomposition.

**Code references:** `findisatoinsertmolecule` in `backend/green/granf2.c`.

**Concrete example:**
- Fragmented: 10 inserts of single characters → `compare_versions` returns 1 shared span pair with `source: {start: "1.1", width: "0.10"}`, `dest: {start: "1.1", width: "0.10"}`
- Bulk: 1 insert of "ABCDEFGHIJ" → `compare_versions` also returns 1 shared span pair
- Both are structurally identical in I-space

**Provenance:** Finding 0033

### FC-DOC-ISOLATION
**What happens:** When a partial vcopy is performed from a fragmented-insert document (e.g., copying only positions 3–7 from a 10-character document), the result is still 1 I-span in the target, not 5. The I-space contiguity of the source is preserved through the vcopy into the target's V-to-I mapping.

**Why it matters for spec:** Frame condition: vcopy of a contiguous V-span that maps to contiguous I-addresses produces a contiguous I-span mapping in the target. The vcopy operation preserves the consolidation structure of the source's I-space mapping. This means subranges of consolidated spans remain consolidated.

**Concrete example:**
- Source doc has 10 characters at V-positions 1–10, all mapping to contiguous I-addresses
- Vcopy positions 3–7 to new document
- Result: 1 shared span pair with `source: {start: "1.3", width: "0.5"}`, `dest: {start: "1.1", width: "0.5"}`

**Provenance:** Finding 0033
