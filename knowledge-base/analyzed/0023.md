# Finding 0023 Analysis

## Entries

### INV-IADDRESS-PERMANENT

**What happens:** Once an I-address is associated with a document (via insert or vcopy), `find_documents` continues to report that document even after the content is deleted from the document's V-stream. Deletion removes content from the visible view but does not remove the I-address association from the document's address space. This is a permanent, monotonic property — documents only accumulate I-address associations over their lifetime.

**Why it matters for spec:** Invariant: for any document D, if I-address `α` was ever present in D, then `FINDDOCSCONTAINING(α) ⊇ {D}` for all future states, regardless of deletions. Formally: `∀ D, α: α ∈ I-addresses-ever(D) ⟹ D ∈ FINDDOCSCONTAINING(α)`. This is a monotonicity invariant — the set of documents returned by `FINDDOCSCONTAINING` for a given I-address can only grow, never shrink.

**Concrete example:**
```
Source: "Findable content"          # I-addresses α₁..αₙ
Dest:   "Prefix: " + vcopy("Findable") → "Prefix: Findable"

Before delete:
  find_documents("Findable") → [Source, Dest]   # 2 documents

After delete("Findable" from Dest):
  retrieve(Dest) → "Prefix: "                   # content gone from V-stream
  find_documents("Findable") → [Source, Dest]    # still 2 documents
```

The document `Dest` no longer contains "Findable" in its V-stream, but the I-address association persists in the spanf index.

**Code references:** Test `find_documents_after_delete` in golden/discovery/. Related: `FC-CONTENT-SPANF-ISOLATION` from Finding 0018 (deletion from one doc doesn't affect other docs; this finding shows deletion doesn't even affect the *same* doc's findability).

**Provenance:** Finding 0023.

### ST-DELETE

**What happens:** Delete removes content from a document's V-stream (visible content) but does NOT remove the content's I-address from the document's address space or from the spanf index. After deletion, `retrieve_contents` no longer returns the deleted content, but `find_documents` still reports the document as containing that content identity.

**Why it matters for spec:** Delete postcondition must be stated precisely in two parts:
1. V-stream effect: the deleted span is removed from the document's visible content
2. I-stream non-effect: the I-address association is preserved — `FINDDOCSCONTAINING` results are unchanged

This dual nature means the delete postcondition is: `retrieve(D_after) = retrieve(D_before) \ deleted_span` AND `FINDDOCSCONTAINING(α) = FINDDOCSCONTAINING(α)_before` for all I-addresses `α` in the deleted span.

**Concrete example:**
```
Before: Dest contains "Prefix: Findable"
  V-stream: "Prefix: Findable"
  I-address associations: {α_P, α_r, ..., α_e (for "Prefix: "), β_F, β_i, ..., β_e (for "Findable")}

After DELETE("Findable" from Dest):
  V-stream: "Prefix: "           # β addresses gone from V-stream
  I-address associations: unchanged — β addresses still in spanf index for Dest
```

**Code references:** Test `find_documents_after_delete` in golden/discovery/.

**Provenance:** Finding 0023.

### SS-DUAL-ENFILADE

**What happens:** The finding confirms the dual-enfilade architecture: documents have both a V-stream (current visible content, affected by delete) and an I-stream (historical content identity, unaffected by delete). `retrieve_contents` reads the V-stream; `find_documents` reads the I-stream/spanf index. These are distinct data structures with different semantics.

**Why it matters for spec:** The state model must represent documents as having two separate mappings:
- V-mapping: `V-address → character` (mutable, reflects current content)
- I-association: `set of I-addresses` (monotonically growing, reflects all content ever placed)

Operations modify these independently: insert/vcopy adds to both; delete removes from V-mapping only; `retrieve` reads V-mapping; `find_documents` reads I-association.

**Code references:** Observed via `retrieve_contents` vs `find_documents` divergence after delete in golden/discovery/find_documents_after_delete.json.

**Provenance:** Finding 0023, Interpretation section.
